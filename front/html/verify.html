<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wallet Verification</title>
</head>
<body>
    <h1>Verify Wallet Ownership</h1>

    <!-- Input field for the user to enter the wallet address -->
    <label for="walletAddress">Enter Wallet Address:</label>
    <input type="text" id="walletAddress" placeholder="0x..." />

    <button id="verifyWallet">Verify Wallet</button>

    <script src="https://cdn.jsdelivr.net/npm/web3@latest/dist/web3.min.js"></script>
    <script>
        // Load Web3.js when MetaMask is available
        window.addEventListener('load', async () => {
            if (typeof window.ethereum !== 'undefined') {
                window.web3 = new Web3(window.ethereum);
                try {
                    // Request account access if needed
                    await window.ethereum.request({ method: 'eth_requestAccounts' });
                } catch (error) {
                    console.error("User denied account access");
                }
            } else {
                alert("MetaMask is not detected. Please install MetaMask or open this in MetaMask's mobile browser.");
            }
        });

        // Function to verify the wallet
        async function verifyWallet() {
            // Get the wallet address from the input field
            const walletAddress = document.getElementById('walletAddress').value.trim();

            if (!walletAddress) {
                alert("Please enter a valid wallet address");
                return;
            }

            if (typeof window.ethereum !== 'undefined') {
                try {
                    // Step 1: Fetch challenge from backend
                    const challengeResponse = await fetch('https://iktomi.pro/api/web3/generate-challenge/', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ wallet_address: walletAddress })
                    });
                    const { challenge } = await challengeResponse.json();

                    // Step 2: Use Web3.js to sign the challenge with MetaMask
                    const web3 = window.web3;
                    const accounts = await web3.eth.getAccounts();

                    if (accounts.length === 0) {
                        alert("No account found in MetaMask.");
                        return;
                    }

                    const signature = await web3.eth.personal.sign(challenge, accounts[0]);

                    // Step 3: Send the signed message and wallet address to the backend for verification
                    const verifyResponse = await fetch('https://iktomi.pro/api/web3/verify-signature/', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            wallet_address: walletAddress,
                            signature: signature
                        })
                    });

                    const verificationResult = await verifyResponse.json();

                    if (verificationResult.status === "Success") {
                        alert("Wallet verified successfully!");
                    } else {
                        alert("Verification failed.");
                    }

                } catch (error) {
                    console.error("Error during wallet verification:", error);
                    alert("An error occurred during verification.");
                }
            } else {
                alert("No Ethereum wallet detected.");
            }
        }

        // Add event listener to the button
        document.getElementById('verifyWallet').addEventListener('click', verifyWallet);
    </script>
</body>
</html>
How It W